<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Agenda de Actividades</title>
    <link rel="stylesheet" href="/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
</head>
<body>
    <nav>
        <a href="/agenda">Agenda</a>
        <a href="/usuarios-correo">Usuarios Correo</a>
        <a href="/iredadmin/" target="_blank">Admin Correo</a>
        <a href="/mail/" target="_blank">Correo Web</a>
    </nav>

    <div class="container">
        <h1>Registrar Actividad</h1>
        <form action="/guardar-actividad" method="POST">
            <label for="semestre">Semestre:</label>
            <select name="semestre" id="semestre" required>
                <option value="">Seleccione un semestre</option>
                <% semestres.forEach(s => { %>
                    <option value="<%= s.id %>"><%= s.nombre %></option>
                <% }) %>
            </select>

            <label for="curso">Curso:</label>
            <select name="curso" id="curso" required>
                <option value="">Seleccione un curso</option>
            </select>

            <label for="actividad">Actividad:</label>
            <input type="text" name="actividad" required>

            <button type="submit">Agregar Actividad</button>
        </form>

        <h2>Actividades Registradas</h2>
        <table>
            <thead>
                <tr>
                    <th>Semestre</th>
                    <th>Curso</th>
                    <th>Actividad</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                <% if (actividades && actividades.length > 0) { %>
                    <% actividades.forEach(a => { %>
                        <tr>
                            <td><%= a.semestre %></td>
                            <td><%= a.curso %></td>
                            <td><%= a.actividad %></td>
                            <td>
                                <form action="/eliminar-actividad/<%= a.id %>" method="POST" onsubmit="return confirm('¿Seguro que quieres eliminar esta actividad?');">
                                    <button type="submit">Eliminar</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="4" style="text-align: center;">No hay actividades registradas.</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <script>
        const semestreSelect = document.getElementById('semestre');
        const cursoSelect = document.getElementById('curso');

        semestreSelect.addEventListener('change', async () => {
            const id = semestreSelect.value;
            cursoSelect.innerHTML = '<option value="">Cargando cursos...</option>';
            if (!id) {
                cursoSelect.innerHTML = '<option value="">Seleccione un curso</option>';
                return;
            }
            const res = await axios.get(`/cursos/${id}`);
            cursoSelect.innerHTML = '<option value="">Seleccione un curso</option>';
            res.data.forEach(curso => {
                const opt = document.createElement('option');
                opt.value = curso.id;
                opt.textContent = curso.nombre;
                cursoSelect.appendChild(opt);
            });
        });
    </script>
</body>
</html>
