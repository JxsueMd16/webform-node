<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usuarios de Correo</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-left">
            <div class="logo">
                <i class="fas fa-envelope"></i> MailAdmin
            </div>
            <a href="/usuarios-correo">
                <i class="fas fa-users"></i> Usuarios de Correo
            </a>
        </div>
        <div>
            <a href="/iredadmin/" target="_blank">
                <i class="fas fa-cog"></i> Admin Correo
            </a>
            <a href="/mail/" target="_blank">
                <i class="fas fa-inbox"></i> Correo Web
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="header-section fade-in">
            <h1><i class="fas fa-users"></i> Usuarios de Correo Registrados</h1>
            <p>Gestión y monitoreo de cuentas de correo electrónico</p>
        </div>

        <div class="controls fade-in">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Buscar por correo, nombre o dominio...">
                <i class="fas fa-search"></i>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalUsers"><%= usuarios.length %></div>
                    <div class="stat-label">Total Usuarios</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalQuota">
                        <%= (usuarios.reduce((sum, u) => sum + u.quota, 0) / 1024 / 1024).toFixed(2) %>
                    </div>
                    <div class="stat-label">GB Asignados</div>
                </div>
            </div>
        </div>

        <div class="table-container fade-in">
            <table id="usersTable">
                <thead>
                    <tr>
                        <th><i class="fas fa-envelope"></i> Correo</th>
                        <th><i class="fas fa-user"></i> Nombre</th>
                        <th><i class="fas fa-globe"></i> Dominio</th>
                        <th><i class="fas fa-hdd"></i> Espacio Asignado</th>
                    </tr>
                </thead>
                <tbody>
                    <% usuarios.forEach(usuario => { %>
                        <tr>
                            <td class="email-cell">
                                <i class="fas fa-envelope" style="color: #1abc9c; margin-right: 8px;"></i>
                                <%= usuario.username %>
                            </td>
                            <td>
                                <i class="fas fa-user" style="color: #3498db; margin-right: 8px;"></i>
                                <%= usuario.name %>
                            </td>
                            <td>
                                <span class="domain-badge"><%= usuario.domain %></span>
                            </td>
                            <td class="quota-cell">
                                <div style="margin-bottom: 5px;">
                                    <strong><%= (usuario.quota / 1024).toFixed(2) %> MB</strong> 
                                    (<%= (usuario.quota / 1024 / 1024).toFixed(2) %> GB)
                                </div>
                                <div class="quota-bar">
                                    <div class="quota-fill" style="width: <%= Math.min((usuario.quota / 5120) * 100, 100) %>%"></div>
                                </div>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('tbody tr');
            let matches = 0;

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                    matches++;
                } else {
                    row.style.display = 'none';
                }
            });

            document.getElementById('totalUsers').textContent = matches;
        });
    </script>
</body>
</html>
